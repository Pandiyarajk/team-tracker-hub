{% extends "base.html" %}

{% block title %}Skills Matrix{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-mortarboard"></i> Skills Matrix</h2>
        </div>
        <div class="col text-end">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSkillModal">
                <i class="bi bi-plus-circle"></i> Add Skill
            </button>
        </div>
    </div>

    {% for member_name, member_skills in skills_by_member.items() %}
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-person"></i> {{ member_name }}</h5>
        </div>
        <div class="card-body">
            <div class="row">
                {% for skill in member_skills %}
                <div class="col-md-4 mb-3">
                    <div class="card h-100 border-start 
                        {% if skill.level == 'expert' %}border-success{% elif skill.level == 'intermediate' %}border-info{% else %}border-warning{% endif %} border-3">
                        <div class="card-body">
                            <h6 class="card-title">{{ skill.skill }}</h6>
                            <p class="mb-2">
                                {% if skill.level == 'expert' %}
                                    <span class="badge bg-success">Expert</span>
                                {% elif skill.level == 'intermediate' %}
                                    <span class="badge bg-info">Intermediate</span>
                                {% else %}
                                    <span class="badge bg-warning">Beginner</span>
                                {% endif %}
                            </p>
                            <small class="text-muted">Updated: {{ skill.last_updated|format_date }}</small>
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="editSkill({{ skill|tojson }})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <a href="{{ url_for('delete_skill', skill_id=skill.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">No skills recorded yet.</div>
    {% endfor %}
</div>

<!-- Add Modal -->
<div class="modal fade" id="addSkillModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('add_skill') }}">
                <div class="modal-header">
                    <h5 class="modal-title">Add Skill</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Team Member Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Skill</label>
                        <input type="text" class="form-control" name="skill" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Level</label>
                        <select class="form-select" name="level" required>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Last Updated</label>
                        <input type="date" class="form-control" name="last_updated" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Skill</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editSkillModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" id="editSkillForm">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Skill</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Team Member Name</label>
                        <input type="text" class="form-control" name="name" id="edit_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Skill</label>
                        <input type="text" class="form-control" name="skill" id="edit_skill" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Level</label>
                        <select class="form-select" name="level" id="edit_level" required>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Last Updated</label>
                        <input type="date" class="form-control" name="last_updated" id="edit_last_updated" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Skill</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function editSkill(skill) {
    document.getElementById('edit_name').value = skill.name;
    document.getElementById('edit_skill').value = skill.skill;
    document.getElementById('edit_level').value = skill.level;
    document.getElementById('edit_last_updated').value = skill.last_updated;
    document.getElementById('editSkillForm').action = '/skills/edit/' + skill.id;
    new bootstrap.Modal(document.getElementById('editSkillModal')).show();
}
</script>
{% endblock %}
